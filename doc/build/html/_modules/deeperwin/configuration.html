<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>deeperwin.configuration &mdash; deeperwin 1.0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom_style.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> deeperwin
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">DeepErwin Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">Full documentation for developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../indices.html">Indices and tables</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">deeperwin</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>deeperwin.configuration</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for deeperwin.configuration</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">DeepErwin hyperparameter and configuration management.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">pydantic</span>
<span class="kn">import</span> <span class="nn">ruamel.yaml.comments</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">validator</span><span class="p">,</span> <span class="n">root_validator</span>
<span class="kn">from</span> <span class="nn">pydantic.fields</span> <span class="kn">import</span> <span class="n">ModelField</span>


<div class="viewcode-block" id="ConfigModel"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.ConfigModel.html#deeperwin.configuration.ConfigModel">[docs]</a><span class="k">class</span> <span class="nc">ConfigModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for all config models&quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_to_prettified_yaml</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_convert_to_inline_block</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">ruamel</span><span class="o">.</span><span class="n">yaml</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">CommentedSeq</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">s</span><span class="o">.</span><span class="n">fa</span><span class="o">.</span><span class="n">set_flow_style</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">s</span>

        <span class="k">def</span> <span class="nf">_convert_data</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">_convert_data</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">_convert_to_inline_block</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">d</span>

        <span class="k">return</span> <span class="n">_convert_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_prettified_yaml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">ruamel</span><span class="o">.</span><span class="n">yaml</span><span class="o">.</span><span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ConfigModel&#39;</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">ruamel</span><span class="o">.</span><span class="n">yaml</span><span class="o">.</span><span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">parse_obj</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_as_flattened_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">output_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">():</span>
            <span class="n">subconfig</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">subconfig</span><span class="p">,</span> <span class="s1">&#39;get_as_flattened_dict&#39;</span><span class="p">):</span>
                <span class="n">subdict</span> <span class="o">=</span> <span class="n">subconfig</span><span class="o">.</span><span class="n">get_as_flattened_dict</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">sublabel</span><span class="p">,</span> <span class="n">subvalue</span> <span class="ow">in</span> <span class="n">subdict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">output_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">sublabel</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subvalue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">output_dict</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">subconfig</span>
        <span class="k">return</span> <span class="n">output_dict</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">update_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">,</span> <span class="n">config_changes</span><span class="p">):</span>
        <span class="c1"># First loop: Build an updated dictionary</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">config_changes</span><span class="p">:</span>
            <span class="n">set_with_nested_key</span><span class="p">(</span><span class="n">config_dict</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="c1"># Parse the config dict and validate that all parameters are valid</span>
        <span class="n">config</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">parse_obj</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span>

        <span class="c1"># Second loop: Update the values using the parsed values to get correct type; Not strictly necessary,</span>
        <span class="c1"># but yields nicer looking input-config files</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">config_changes</span><span class="p">:</span>
            <span class="n">set_with_nested_key</span><span class="p">(</span><span class="n">config_dict</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">get_attribute_by_nested_key</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">config_dict</span><span class="p">,</span> <span class="n">config</span>

<div class="viewcode-block" id="ConfigModel.Config"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.ConfigModel.html#deeperwin.configuration.ConfigModel.Config">[docs]</a>    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The name &#39;Config&#39; here is a pydantic term used to config the behaviour of the dataclass.</span>
<span class="sd">        It&#39;s not a config for the variational monte carlo code&quot;&quot;&quot;</span>
        <span class="n">extra</span> <span class="o">=</span> <span class="s2">&quot;forbid&quot;</span></div></div>


<div class="viewcode-block" id="NetworkConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.NetworkConfig.html#deeperwin.configuration.NetworkConfig">[docs]</a><span class="k">class</span> <span class="nc">NetworkConfig</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
    <span class="n">net_width</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">net_depth</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_default_network_shape</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_set_embedding_widths</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">ModelField</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;n_hidden&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">n_hidden</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_default_network_shape</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;n_hidden_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;net_width&#39;</span><span class="p">],</span>
                                                 <span class="n">values</span><span class="p">[</span><span class="s1">&#39;net_depth&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">n_hidden</span></div>


<div class="viewcode-block" id="SimpleSchnetConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.SimpleSchnetConfig.html#deeperwin.configuration.SimpleSchnetConfig">[docs]</a><span class="k">class</span> <span class="nc">SimpleSchnetConfig</span><span class="p">(</span><span class="n">NetworkConfig</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;simple_schnet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;simple_schnet&quot;</span>
    <span class="n">embedding_dim</span> <span class="o">=</span> <span class="mi">64</span>
    <span class="n">n_iterations</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">net_width</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40</span>
    <span class="n">net_depth</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">n_hidden_w</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">n_hidden_h</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">n_hidden_g</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">use_res_net</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_default_network_shape</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="p">[</span><span class="n">width</span><span class="p">]</span> <span class="o">*</span> <span class="n">depth</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="p">[</span><span class="n">width</span><span class="p">]</span> <span class="o">*</span> <span class="n">depth</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="p">[</span><span class="n">width</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))[</span><span class="n">key</span><span class="p">]</span></div>


<div class="viewcode-block" id="DummyEmbeddingConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.DummyEmbeddingConfig.html#deeperwin.configuration.DummyEmbeddingConfig">[docs]</a><span class="k">class</span> <span class="nc">DummyEmbeddingConfig</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;dummy&quot;</span><span class="p">]</span></div>


<div class="viewcode-block" id="CuspCorrectionConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.CuspCorrectionConfig.html#deeperwin.configuration.CuspCorrectionConfig">[docs]</a><span class="k">class</span> <span class="nc">CuspCorrectionConfig</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">use</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">cusp_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;mo&quot;</span><span class="p">,</span> <span class="s2">&quot;ao&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mo&quot;</span>
    <span class="n">r_cusp_el_el</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">r_cusp_el_ion_scale</span> <span class="o">=</span> <span class="mf">1.0</span></div>


<div class="viewcode-block" id="CASSCFConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.CASSCFConfig.html#deeperwin.configuration.CASSCFConfig">[docs]</a><span class="k">class</span> <span class="nc">CASSCFConfig</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;casscf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;casscf&quot;</span>
    <span class="n">basis_set</span> <span class="o">=</span> <span class="s2">&quot;6-311G&quot;</span>
    <span class="n">n_determinants</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">cusps</span> <span class="o">=</span> <span class="n">CuspCorrectionConfig</span><span class="p">()</span></div>


<div class="viewcode-block" id="DeepErwinModelConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.DeepErwinModelConfig.html#deeperwin.configuration.DeepErwinModelConfig">[docs]</a><span class="k">class</span> <span class="nc">DeepErwinModelConfig</span><span class="p">(</span><span class="n">NetworkConfig</span><span class="p">):</span>
    <span class="n">net_width</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40</span>
    <span class="n">net_depth</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">n_hidden_bf_factor</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">n_hidden_bf_shift</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">n_hidden_jastrow</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">use_bf_factor</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">use_bf_shift</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">use_jastrow</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">el_el_shift_decay</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">target_el</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">sum_first</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">output_shift</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">distance_feature_powers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">sigma_pauli</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">use_trainable_shift_decay_radius</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">n_rbf_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">32</span>
    <span class="n">eps_dist_feat</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-2</span>
    <span class="n">n_pairwise_features</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">embedding</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SimpleSchnetConfig</span><span class="p">,</span> <span class="n">DummyEmbeddingConfig</span><span class="p">]</span> <span class="o">=</span> <span class="n">SimpleSchnetConfig</span><span class="p">()</span>
    <span class="n">baseline</span> <span class="o">=</span> <span class="n">CASSCFConfig</span><span class="p">()</span>

    <span class="n">register_scale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_default_network_shape</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bf_factor</span><span class="o">=</span><span class="p">[</span><span class="n">width</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">width</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">depth</span><span class="p">,</span> <span class="n">bf_shift</span><span class="o">=</span><span class="p">[</span><span class="n">width</span><span class="p">]</span> <span class="o">*</span> <span class="n">depth</span><span class="p">,</span> <span class="n">jastrow</span><span class="o">=</span><span class="p">[</span><span class="n">width</span><span class="p">]</span> <span class="o">*</span> <span class="n">depth</span><span class="p">)[</span><span class="n">key</span><span class="p">]</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;n_pairwise_features&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">total_number_of_pairwise_features</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="n">n_required</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;n_rbf_features&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;distance_feature_powers&#39;</span><span class="p">])</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n_required</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">n</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">n_required</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Number of total pairwise features </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> is inconsistent with n_rbf_features=</span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;n_rbf_features&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> and distance_feature_powers=</span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;distance_feature_powers&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">n</span></div>


<div class="viewcode-block" id="MCMCSimpleProposalConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.MCMCSimpleProposalConfig.html#deeperwin.configuration.MCMCSimpleProposalConfig">[docs]</a><span class="k">class</span> <span class="nc">MCMCSimpleProposalConfig</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="s2">&quot;cauchy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span></div>


<div class="viewcode-block" id="MCMCLangevinProposalConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.MCMCLangevinProposalConfig.html#deeperwin.configuration.MCMCLangevinProposalConfig">[docs]</a><span class="k">class</span> <span class="nc">MCMCLangevinProposalConfig</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;langevin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;langevin&quot;</span>
    <span class="n">langevin_scale</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">r_min</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="n">r_max</span> <span class="o">=</span> <span class="mf">2.0</span></div>


<div class="viewcode-block" id="MCMCConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.MCMCConfig.html#deeperwin.configuration.MCMCConfig">[docs]</a><span class="k">class</span> <span class="nc">MCMCConfig</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">n_walkers_opt</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2048</span>
    <span class="n">n_walkers_eval</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">n_inter_steps</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">n_burn_in_opt</span> <span class="o">=</span> <span class="mi">2000</span>
    <span class="n">n_burn_in_eval</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="n">target_acceptance_rate</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">min_stepsize_scale</span> <span class="o">=</span> <span class="mf">1e-2</span>
    <span class="n">max_stepsize_scale</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">max_age_opt</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">max_age_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>

    <span class="n">proposal</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">MCMCLangevinProposalConfig</span><span class="p">,</span> <span class="n">MCMCSimpleProposalConfig</span><span class="p">]</span> <span class="o">=</span> <span class="n">MCMCSimpleProposalConfig</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;n_walkers_eval&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">populate_n_walkers_eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">n</span> <span class="ow">or</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;n_walkers_opt&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="ClippingConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.ClippingConfig.html#deeperwin.configuration.ClippingConfig">[docs]</a><span class="k">class</span> <span class="nc">ClippingConfig</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;hard&quot;</span><span class="p">,</span> <span class="s2">&quot;tanh&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;tanh&quot;</span>
    <span class="n">width_metric</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">,</span> <span class="s2">&quot;mae&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;std&quot;</span>
    <span class="n">center</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span>
    <span class="n">unclipped_center</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">clip_by</span> <span class="o">=</span> <span class="mf">5.0</span></div>


<div class="viewcode-block" id="FixedLRSchedule"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.FixedLRSchedule.html#deeperwin.configuration.FixedLRSchedule">[docs]</a><span class="k">class</span> <span class="nc">FixedLRSchedule</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;fixed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fixed&quot;</span></div>


<div class="viewcode-block" id="InverseLRScheduleConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.InverseLRScheduleConfig.html#deeperwin.configuration.InverseLRScheduleConfig">[docs]</a><span class="k">class</span> <span class="nc">InverseLRScheduleConfig</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;inverse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;inverse&quot;</span>
    <span class="n">decay_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">500.0</span></div>


<div class="viewcode-block" id="StandardOptimizerConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.StandardOptimizerConfig.html#deeperwin.configuration.StandardOptimizerConfig">[docs]</a><span class="k">class</span> <span class="nc">StandardOptimizerConfig</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;rmsprop_momentum&quot;</span><span class="p">,</span> <span class="s2">&quot;sgd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sgd&quot;</span>  <span class="c1"># add others optimizers that don&#39;t need further configs here</span>
    <span class="n">order</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></div>


<div class="viewcode-block" id="AdamOptimizerConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.AdamOptimizerConfig.html#deeperwin.configuration.AdamOptimizerConfig">[docs]</a><span class="k">class</span> <span class="nc">AdamOptimizerConfig</span><span class="p">(</span><span class="n">StandardOptimizerConfig</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;adam&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;adam&quot;</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="mf">0.9</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="mf">0.999</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-8</span></div>


<div class="viewcode-block" id="KFACOptimizerConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.KFACOptimizerConfig.html#deeperwin.configuration.KFACOptimizerConfig">[docs]</a><span class="k">class</span> <span class="nc">KFACOptimizerConfig</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;kfac&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;kfac&quot;</span>
    <span class="n">order</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">momentum</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">norm_constraint</span> <span class="o">=</span> <span class="mf">0.0004</span>
    <span class="n">damping</span> <span class="o">=</span> <span class="mf">0.00085</span>
    <span class="n">damping_scheduler</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">estimation_mode</span> <span class="o">=</span> <span class="s1">&#39;fisher_gradients&#39;</span>
    <span class="n">register_generic</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">update_inverse_period</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">decay_time</span> <span class="o">=</span> <span class="mi">6000</span>
    <span class="n">decay_time_damping</span> <span class="o">=</span> <span class="mi">6000</span>
    <span class="n">min_damping</span> <span class="o">=</span> <span class="mf">1e-4</span>
    <span class="n">curvature_ema</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">internal_optimizer</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AdamOptimizerConfig</span><span class="p">,</span> <span class="n">StandardOptimizerConfig</span><span class="p">]</span> <span class="o">=</span> <span class="n">AdamOptimizerConfig</span><span class="p">()</span></div>


<div class="viewcode-block" id="BFGSOptimizerConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.BFGSOptimizerConfig.html#deeperwin.configuration.BFGSOptimizerConfig">[docs]</a><span class="k">class</span> <span class="nc">BFGSOptimizerConfig</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;slbfgs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;slbfgs&quot;</span>
    <span class="n">order</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">internal_optimizer</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AdamOptimizerConfig</span><span class="p">,</span> <span class="n">StandardOptimizerConfig</span><span class="p">]</span> <span class="o">=</span> <span class="n">AdamOptimizerConfig</span><span class="p">()</span>
    <span class="n">memory_length</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="n">hessian_regularization</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">200.0</span>
    <span class="n">norm_constraint</span> <span class="o">=</span> <span class="mf">1.5e-3</span>
    <span class="n">use_variance_reduction</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">update_hessian_every_n_epochs</span> <span class="o">=</span> <span class="mi">1</span></div>


<div class="viewcode-block" id="IntermediateEvaluationConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.IntermediateEvaluationConfig.html#deeperwin.configuration.IntermediateEvaluationConfig">[docs]</a><span class="k">class</span> <span class="nc">IntermediateEvaluationConfig</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">n_epochs</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="n">opt_epochs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="OptimizationConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.OptimizationConfig.html#deeperwin.configuration.OptimizationConfig">[docs]</a><span class="k">class</span> <span class="nc">OptimizationConfig</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">optimizer</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">AdamOptimizerConfig</span><span class="p">,</span> <span class="n">StandardOptimizerConfig</span><span class="p">,</span> <span class="n">KFACOptimizerConfig</span><span class="p">,</span> <span class="n">BFGSOptimizerConfig</span><span class="p">]</span> <span class="o">=</span> <span class="n">AdamOptimizerConfig</span><span class="p">()</span>
    <span class="n">schedule</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">InverseLRScheduleConfig</span><span class="p">,</span> <span class="n">FixedLRSchedule</span><span class="p">]</span> <span class="o">=</span> <span class="n">InverseLRScheduleConfig</span><span class="p">()</span>
    <span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">1.5e-3</span>
    <span class="n">n_epochs</span> <span class="o">=</span> <span class="mi">10_000</span>
    <span class="n">n_epochs_prev</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># if run is restart, this can be used to store number of previous epochs</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">512</span>
    <span class="n">use_batch_reweighting</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">checkpoints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">clipping</span> <span class="o">=</span> <span class="n">ClippingConfig</span><span class="p">()</span>
    <span class="n">intermediate_eval</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IntermediateEvaluationConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">interdependent</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">shared_modules</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;embed&quot;</span><span class="p">,</span> <span class="s2">&quot;jastrow&quot;</span><span class="p">,</span> <span class="s2">&quot;bf_fac&quot;</span><span class="p">,</span> <span class="s2">&quot;bf_shift&quot;</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@root_validator</span>
    <span class="k">def</span> <span class="nf">shared_modules_only_with_interdependent</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;shared_modules&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;interdependent&quot;</span><span class="p">]:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Shared optimization is only possible with interdependent optimization. Setting shared_modules to None.&quot;</span><span class="p">)</span>
                <span class="n">values</span><span class="p">[</span><span class="s1">&#39;shared_modules&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">values</span></div>


<div class="viewcode-block" id="RestartConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.RestartConfig.html#deeperwin.configuration.RestartConfig">[docs]</a><span class="k">class</span> <span class="nc">RestartConfig</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">reuse_params</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">reuse_mcmc_state</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">recursive</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">checkpoints</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="ForceEvaluationConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.ForceEvaluationConfig.html#deeperwin.configuration.ForceEvaluationConfig">[docs]</a><span class="k">class</span> <span class="nc">ForceEvaluationConfig</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">R_cut</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">R_core</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">use_polynomial</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">use_antithetic_sampling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">polynomial_degree</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span></div>


<div class="viewcode-block" id="EvaluationConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.EvaluationConfig.html#deeperwin.configuration.EvaluationConfig">[docs]</a><span class="k">class</span> <span class="nc">EvaluationConfig</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">n_epochs</span> <span class="o">=</span> <span class="mi">2000</span>
    <span class="n">forces</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ForceEvaluationConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="PhysicalConfigChange"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.PhysicalConfigChange.html#deeperwin.configuration.PhysicalConfigChange">[docs]</a><span class="k">class</span> <span class="nc">PhysicalConfigChange</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">R</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]]</span>
    <span class="n">E_ref</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
    <span class="n">comment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></div>


<div class="viewcode-block" id="PhysicalConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.PhysicalConfig.html#deeperwin.configuration.PhysicalConfig">[docs]</a><span class="k">class</span> <span class="nc">PhysicalConfig</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">R</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]]</span>
    <span class="n">Z</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>
    <span class="n">n_electrons</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">n_up</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">el_ion_mapping</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>
    <span class="n">n_cas_electrons</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">n_cas_orbitals</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">E_ref</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
    <span class="n">comment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">changes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PhysicalConfigChange</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">_PERIODIC_TABLE</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;He&#39;</span><span class="p">,</span> <span class="s1">&#39;Li&#39;</span><span class="p">,</span> <span class="s1">&#39;Be&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;Ne&#39;</span><span class="p">,</span> <span class="s1">&#39;Na&#39;</span><span class="p">,</span> <span class="s1">&#39;Mg&#39;</span><span class="p">,</span> <span class="s1">&#39;Al&#39;</span><span class="p">,</span> <span class="s1">&#39;Si&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span>
         <span class="s1">&#39;Cl&#39;</span><span class="p">,</span> <span class="s1">&#39;Ar&#39;</span><span class="p">])}</span>
    <span class="n">_DEFAULT_GEOMETRIES</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">H2</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]],</span>
                               <span class="n">N2</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.06800</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]],</span>
                               <span class="n">LiH</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.015</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]],</span>
                               <span class="n">HChain10</span><span class="o">=</span><span class="p">[[</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)],</span>
                               <span class="n">HChain6</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.8</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)],</span>
                               <span class="n">Ethene</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.26517164</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.26517164</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.328293764</span><span class="p">,</span> <span class="mf">1.7554138407</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                       <span class="p">[</span><span class="mf">2.328293764</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7554138407</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                       <span class="p">[</span><span class="o">-</span><span class="mf">2.328293764</span><span class="p">,</span> <span class="mf">1.7554138407</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.328293764</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7554138407</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
                               <span class="n">EtheneBarrier</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.26517164</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.26517164</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.328293764</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.7554138407</span><span class="p">],</span>
                                              <span class="p">[</span><span class="mf">2.328293764</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7554138407</span><span class="p">],</span>
                                              <span class="p">[</span><span class="o">-</span><span class="mf">2.328293764</span><span class="p">,</span> <span class="mf">1.7554138407</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.328293764</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7554138407</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
                               <span class="n">Cyclobutadiene</span><span class="o">=</span><span class="p">[</span>
                                   <span class="p">[</span><span class="o">-</span><span class="mf">1.4777688</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2793472</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                   <span class="p">[</span><span class="o">+</span><span class="mf">1.4777688</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2793472</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                   <span class="p">[</span><span class="o">+</span><span class="mf">1.4777688</span><span class="p">,</span> <span class="o">+</span><span class="mf">1.2793472</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                   <span class="p">[</span><span class="o">-</span><span class="mf">1.4777688</span><span class="p">,</span> <span class="o">+</span><span class="mf">1.2793472</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                   <span class="p">[</span><span class="o">-</span><span class="mf">2.9180622</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7226601</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                   <span class="p">[</span><span class="o">+</span><span class="mf">2.9180622</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7226601</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                   <span class="p">[</span><span class="o">+</span><span class="mf">2.9180622</span><span class="p">,</span> <span class="o">+</span><span class="mf">2.7226601</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                   <span class="p">[</span><span class="o">-</span><span class="mf">2.9180622</span><span class="p">,</span> <span class="o">+</span><span class="mf">2.7226601</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                               <span class="p">])</span>
    <span class="n">_DEFAULT_CHARGES</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">H2</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                            <span class="n">N2</span><span class="o">=</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
                            <span class="n">LiH</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                            <span class="n">HChain10</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span>
                            <span class="n">HChain6</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span><span class="p">,</span>
                            <span class="n">Ethene</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                            <span class="n">EtheneBarrier</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                            <span class="n">Cyclobutadiene</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">_DEFAULT_SPIN</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">H</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">He</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Li</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Be</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">O</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">F</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Ne</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Na</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Mg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Al</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Si</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">Cl</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                         <span class="n">Ar</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Ethene</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Cyclobutadiene</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">HChain6</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">HChain10</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">_DEFAULT_EL_ION_MAPPINGS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">H2</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                    <span class="n">N2</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                    <span class="n">LiH</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                    <span class="n">HChain6</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
                                    <span class="n">HChain10</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
                                    <span class="n">Ethene</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
                                    <span class="n">Cyclobutadiene</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                                                    <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
                                    <span class="p">)</span>
    <span class="n">_DEFAULT_CAS_N_ACTIVE_ORBITALS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">He</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">Li</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">Be</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">LiH</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">O</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">F</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                                          <span class="n">Ne</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">H2</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">Li2</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">Be2</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">B2</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">C2</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">N2</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                          <span class="n">H2p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">H3plus</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">H4plus</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">H4Rect</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">HChain6</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">HChain10</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                          <span class="n">Ethene</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">Cyclobutadiene</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="n">_DEFAULT_CAS_N_ACTIVE_ELECTRONS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">He</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">Li</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">Be</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">LiH</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">O</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">F</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">Ne</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">H2</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">Li2</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">Be2</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                           <span class="n">B2</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">C2</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">N2</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">H2p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">H3plus</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">H4plus</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">H4Rect</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">HChain6</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                           <span class="n">HChain10</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">Ethene</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">Cyclobutadiene</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="n">_REFERENCE_ENERGIES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;He&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.90372</span><span class="p">,</span> <span class="s1">&#39;Li&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">7.478067</span><span class="p">,</span> <span class="s1">&#39;Be&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">14.66733</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">24.65371</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">37.84471</span><span class="p">,</span>
                           <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">54.58882</span><span class="p">,</span>
                           <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">75.06655</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">99.7329</span><span class="p">,</span> <span class="s1">&#39;Ne&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">128.9366</span><span class="p">,</span> <span class="s1">&#39;H2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.17448</span><span class="p">,</span> <span class="s1">&#39;LiH&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">8.070548</span><span class="p">,</span>
                           <span class="s1">&#39;N2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">109.5423</span><span class="p">,</span> <span class="s1">&#39;Li2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">14.9954</span><span class="p">,</span> <span class="s1">&#39;CO&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">113.3255</span><span class="p">,</span> <span class="s1">&#39;Be2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">29.338</span><span class="p">,</span> <span class="s1">&#39;B2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">49.4141</span><span class="p">,</span>
                           <span class="s1">&#39;C2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">75.9265</span><span class="p">,</span> <span class="s1">&#39;O2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">150.3274</span><span class="p">,</span> <span class="s1">&#39;F2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">199.5304</span><span class="p">,</span> <span class="s1">&#39;H4Rect&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.0155</span><span class="p">,</span>
                           <span class="s1">&#39;H3plus&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.3438355180000001</span><span class="p">,</span> <span class="s1">&#39;H4plus&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.8527330000000002</span><span class="p">,</span> <span class="s1">&#39;HChain6&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">3.40583160</span><span class="p">,</span>
                           <span class="s1">&#39;HChain10&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">5.6655</span><span class="p">,</span> <span class="s1">&#39;Ethene&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">78.57744597</span><span class="p">}</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">populate_R</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_PERIODIC_TABLE</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_DEFAULT_GEOMETRIES</span><span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">populate_Z</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_PERIODIC_TABLE</span><span class="p">:</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">_PERIODIC_TABLE</span><span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_DEFAULT_CHARGES</span><span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;List of nuclear charges Z has length </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span><span class="si">}</span><span class="s2">, but list of ion positions R has length </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Z</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;n_electrons&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">populate_n_electrons</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">v</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;n_up&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">populate_n_up</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spin</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_DEFAULT_SPIN</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="ow">or</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;n_electrons&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">spin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>  <span class="c1"># if there is an extra electrons, assign them to up</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;el_ion_mapping&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">populate_el_ion_mapping</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_PERIODIC_TABLE</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;n_electrons&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_DEFAULT_EL_ION_MAPPINGS</span><span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">!=</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;n_electrons&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;An initial ion-mapping must be supplied for all electrons. len(el_ion_mapping)=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s2">, n_electrons=</span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;n_electrons&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;n_cas_electrons&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">populate_n_cas_electrons</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_DEFAULT_CAS_N_ACTIVE_ELECTRONS</span><span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;n_cas_orbitals&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">populate_n_cas_orbitals</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_DEFAULT_CAS_N_ACTIVE_ORBITALS</span><span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;E_ref&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">populate_E_ref</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_REFERENCE_ENERGIES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">set_from_changes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">changes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">change</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">changes</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">PhysicalConfig</span><span class="o">.</span><span class="n">update_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">(),</span> <span class="n">change</span><span class="o">.</span><span class="n">get_as_flattened_dict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">p</span><span class="o">.</span><span class="n">changes</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="LoggerBaseConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.LoggerBaseConfig.html#deeperwin.configuration.LoggerBaseConfig">[docs]</a><span class="k">class</span> <span class="nc">LoggerBaseConfig</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">n_skip_epochs</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="WandBConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.WandBConfig.html#deeperwin.configuration.WandBConfig">[docs]</a><span class="k">class</span> <span class="nc">WandBConfig</span><span class="p">(</span><span class="n">LoggerBaseConfig</span><span class="p">):</span>
    <span class="n">project</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
    <span class="n">entity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></div>


<div class="viewcode-block" id="BasicLoggerConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.BasicLoggerConfig.html#deeperwin.configuration.BasicLoggerConfig">[docs]</a><span class="k">class</span> <span class="nc">BasicLoggerConfig</span><span class="p">(</span><span class="n">LoggerBaseConfig</span><span class="p">):</span>
    <span class="n">log_to_stdout</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">log_level</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;CRITICAL&quot;</span><span class="p">,</span> <span class="s2">&quot;FATAL&quot;</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;WARN&quot;</span><span class="p">,</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;DEBUG&quot;</span>
    <span class="n">n_skip_epochs</span> <span class="o">=</span> <span class="mi">9</span>
    <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;log.out&quot;</span></div>


<div class="viewcode-block" id="PickleLoggerConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.PickleLoggerConfig.html#deeperwin.configuration.PickleLoggerConfig">[docs]</a><span class="k">class</span> <span class="nc">PickleLoggerConfig</span><span class="p">(</span><span class="n">LoggerBaseConfig</span><span class="p">):</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;results.bz2&#39;</span></div>


<div class="viewcode-block" id="LoggingConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.LoggingConfig.html#deeperwin.configuration.LoggingConfig">[docs]</a><span class="k">class</span> <span class="nc">LoggingConfig</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">log_opt_state</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">basic</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BasicLoggerConfig</span><span class="p">]</span> <span class="o">=</span> <span class="n">BasicLoggerConfig</span><span class="p">()</span>
    <span class="n">wandb</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">WandBConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">pickle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PickleLoggerConfig</span><span class="p">]</span> <span class="o">=</span> <span class="n">PickleLoggerConfig</span><span class="p">()</span></div>

    <span class="c1"># @classmethod</span>
    <span class="c1"># def get_logger_names(cls):</span>
    <span class="c1">#     logger_names = []</span>
    <span class="c1">#     for k, v in cls.__dict__[&quot;__fields__&quot;].items():</span>
    <span class="c1">#         if issubclass(v.type_, LoggerBaseConfig):</span>
    <span class="c1">#             logger_names.append(k)</span>
    <span class="c1">#     return logger_names</span>


<div class="viewcode-block" id="DispatchConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.DispatchConfig.html#deeperwin.configuration.DispatchConfig">[docs]</a><span class="k">class</span> <span class="nc">DispatchConfig</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">system</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="s2">&quot;vsc3&quot;</span><span class="p">,</span> <span class="s2">&quot;vsc4&quot;</span><span class="p">,</span> <span class="s2">&quot;dgx&quot;</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span>
    <span class="n">queue</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
        <span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="s2">&quot;vsc3plus_0064&quot;</span><span class="p">,</span> <span class="s2">&quot;devel_0128&quot;</span><span class="p">,</span> <span class="s2">&quot;gpu_a40dual&quot;</span><span class="p">,</span> <span class="s2">&quot;gpu_gtx1080amd&quot;</span><span class="p">,</span> <span class="s2">&quot;gpu_gtx1080multi&quot;</span><span class="p">,</span> <span class="s2">&quot;gpu_gtx1080single&quot;</span><span class="p">,</span> <span class="s2">&quot;gpu_v100&quot;</span><span class="p">,</span> <span class="s2">&quot;gpu_k20m&quot;</span><span class="p">,</span> <span class="s2">&quot;gpu_rtx2080ti&quot;</span><span class="p">,</span> <span class="s2">&quot;jupyter&quot;</span><span class="p">,</span> <span class="s2">&quot;normal_binf&quot;</span><span class="p">,</span> <span class="s2">&quot;vsc3plus_0256&quot;</span><span class="p">,</span> <span class="s2">&quot;mem_0096&quot;</span><span class="p">,</span> <span class="s2">&quot;devel_0096&quot;</span><span class="p">,</span> <span class="s2">&quot;jupyter&quot;</span><span class="p">,</span> <span class="s2">&quot;mem_0096&quot;</span><span class="p">,</span> <span class="s2">&quot;mem_0384&quot;</span><span class="p">,</span> <span class="s2">&quot;mem_0768&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
    <span class="n">time</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1day&quot;</span>
    <span class="n">conda_env</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;jax&quot;</span></div>


<div class="viewcode-block" id="ComputationConfig"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.ComputationConfig.html#deeperwin.configuration.ComputationConfig">[docs]</a><span class="k">class</span> <span class="nc">ComputationConfig</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">use_gpu</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">disable_jit</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">float_precision</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;float32&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;float32&quot;</span></div>


<div class="viewcode-block" id="Configuration"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.Configuration.html#deeperwin.configuration.Configuration">[docs]</a><span class="k">class</span> <span class="nc">Configuration</span><span class="p">(</span><span class="n">ConfigModel</span><span class="p">):</span>
    <span class="n">physical</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PhysicalConfig</span><span class="p">]</span>
    <span class="n">mcmc</span> <span class="o">=</span> <span class="n">MCMCConfig</span><span class="p">()</span>
    <span class="n">optimization</span> <span class="o">=</span> <span class="n">OptimizationConfig</span><span class="p">()</span>
    <span class="n">evaluation</span> <span class="o">=</span> <span class="n">EvaluationConfig</span><span class="p">()</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DeepErwinModelConfig</span><span class="p">]</span> <span class="o">=</span> <span class="n">DeepErwinModelConfig</span><span class="p">()</span>
    <span class="n">logging</span> <span class="o">=</span> <span class="n">LoggingConfig</span><span class="p">()</span>
    <span class="n">computation</span> <span class="o">=</span> <span class="n">ComputationConfig</span><span class="p">()</span>
    <span class="n">dispatch</span> <span class="o">=</span> <span class="n">DispatchConfig</span><span class="p">()</span>
    <span class="n">restart</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RestartConfig</span><span class="p">]</span>
    <span class="n">comment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">experiment_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@root_validator</span>
    <span class="k">def</span> <span class="nf">walkers_divisible_by_batch_size</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="n">n_walkers</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;mcmc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">n_walkers_opt</span>
        <span class="n">batch_size</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;optimization&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">batch_size</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n_walkers</span> <span class="o">%</span> <span class="n">batch_size</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of walkers (</span><span class="si">{</span><span class="n">n_walkers</span><span class="si">}</span><span class="s2">) is not divisible by batch-size (</span><span class="si">{</span><span class="n">batch_size</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="nd">@root_validator</span>
    <span class="k">def</span> <span class="nf">experiment_has_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;experiment_name&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">values</span><span class="p">[</span><span class="s1">&#39;experiment_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;physical&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="n">values</span></div>


<span class="c1"># Helper Functions</span>
<div class="viewcode-block" id="get_attribute_by_nested_key"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.get_attribute_by_nested_key.html#deeperwin.configuration.get_attribute_by_nested_key">[docs]</a><span class="k">def</span> <span class="nf">get_attribute_by_nested_key</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Configuration</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">parent_key</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">child_key</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">return</span> <span class="n">get_attribute_by_nested_key</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">parent_key</span><span class="p">),</span> <span class="n">child_key</span><span class="p">)</span></div>


<div class="viewcode-block" id="set_with_nested_key"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.set_with_nested_key.html#deeperwin.configuration.set_with_nested_key">[docs]</a><span class="k">def</span> <span class="nf">set_with_nested_key</span><span class="p">(</span><span class="n">config_dict</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
        <span class="n">config_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">parent_key</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">child_key</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">if</span> <span class="n">parent_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config_dict</span><span class="p">:</span>
            <span class="n">config_dict</span><span class="p">[</span><span class="n">parent_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">set_with_nested_key</span><span class="p">(</span><span class="n">config_dict</span><span class="p">[</span><span class="n">parent_key</span><span class="p">],</span> <span class="n">child_key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config_dict</span></div>


<div class="viewcode-block" id="build_nested_dict"><a class="viewcode-back" href="../../_autosummary/deeperwin.configuration.build_nested_dict.html#deeperwin.configuration.build_nested_dict">[docs]</a><span class="k">def</span> <span class="nf">build_nested_dict</span><span class="p">(</span><span class="n">flattened_dict</span><span class="p">):</span>
    <span class="n">root_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">flattened_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">key_tokens</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">root_dict</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">key_tokens</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">key_tokens</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>  <span class="c1"># reached leaf =&gt; store value</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>  <span class="c1"># traverse further</span>
    <span class="k">return</span> <span class="n">root_dict</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">pass</span>

    <span class="c1">#</span>
    <span class="c1"># parsed_config = Configuration.parse_obj(raw_config)</span>
    <span class="c1"># physical_configs = parsed_config.physical.set_from_changes()</span>

    <span class="c1"># c = Configuration(physical=PhysicalConfig(name=&#39;C&#39;))</span>
    <span class="c1"># d = c.get_as_flattened_dict()</span>
    <span class="c1"># print(d)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Michael Scherbela, Leon Gerard, Rafael Reisenhofer.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>